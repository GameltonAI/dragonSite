<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DragonCheat - Premium Service</title>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <style>
        /* Базовые стили из прошлых шагов + новые для страниц */
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: sans-serif; }
        body { background-color: #0f0f13; color: white; }
        
        /* Авторизация */
        #auth-screen { display: flex; justify-content: center; align-items: center; height: 100vh; background: radial-gradient(#2a0a0a, #0f0f13); }
        .auth-card { background: #1e1e23; padding: 30px; border-radius: 12px; width: 320px; text-align: center; border: 1px solid #333; }
        input { width: 100%; padding: 10px; margin: 10px 0; background: #151518; border: 1px solid #444; color: white; border-radius: 5px; }
        .btn { width: 100%; padding: 10px; background: #ff3333; border: none; color: white; cursor: pointer; font-weight: bold; border-radius: 5px; }

        /* Основной сайт */
        header { display: flex; justify-content: space-between; padding: 20px 50px; background: #141419; border-bottom: 1px solid #333; }
        nav ul { display: flex; list-style: none; gap: 20px; }
        nav a { color: #ccc; text-decoration: none; text-transform: uppercase; font-size: 13px; cursor: pointer; }
        nav a:hover { color: #ff3333; }

        .content { padding: 40px; max-width: 1200px; margin: 0 auto; }
        .grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(250px, 1fr)); gap: 20px; margin-top: 20px; }
        .card { background: #1e1e23; padding: 15px; border-radius: 10px; cursor: pointer; transition: 0.3s; border: 1px solid #333; }
        .card:hover { transform: translateY(-5px); border-color: #ff3333; }
        .card img { width: 100%; border-radius: 5px; margin-bottom: 10px; }

        /* Модалка Админа */
        #admin-modal { display: none; position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); background: #222; padding: 30px; border-radius: 10px; z-index: 100; border: 1px solid gold; width: 400px; }
        .modal-overlay { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); z-index: 99; }
    </style>
</head>
<body>

    <div id="auth-screen">
        <div class="auth-card">
            <h2 id="auth-title">Dragon ID</h2>
            <input type="email" id="email" placeholder="Email">
            <input type="password" id="password" placeholder="Пароль">
            <button class="btn" onclick="handleAuth()">Войти / Регистрация</button>
            <p style="font-size: 10px; color: #666; margin-top: 10px;">Если аккаунта нет, он создастся автоматически</p>
        </div>
    </div>

    <div id="main-site" style="display: none;">
        <header>
            <div style="display: flex; align-items: center; gap: 10px;">
                <img src="LogoDragon.png" width="30" onerror="this.src='https://via.placeholder.com/30'">
                <strong style="font-size: 20px;">Dragon<span style="color:#ff3333">Cheat</span></strong>
            </div>
            <nav>
                <ul id="nav-list">
                    <li><a onclick="loadNews()">Новости</a></li>
                    <li><a onclick="loadModels()">Модели</a></li>
                    <li><a href="#">Скачать</a></li>
                    <li><a href="#">Конфиги</a></li>
                    <li><a id="admin-btn" style="color: gold; display: none;" onclick="toggleAdminModal(true)">[АДМИН]</a></li>
                </ul>
            </nav>
        </header>

        <div class="content" id="page-content">
            <h1>Добро пожаловать в Dragon ID</h1>
            <p>Выберите раздел в меню выше.</p>
        </div>
    </div>

    <div class="modal-overlay" id="overlay" onclick="toggleAdminModal(false)"></div>
    <div id="admin-modal">
        <h3>Добавить Модель</h3>
        <input type="text" id="m-name" placeholder="Название модели">
        <input type="text" id="m-desc" placeholder="Описание">
        <input type="text" id="m-img" placeholder="Ссылка на картинку">
        <input type="text" id="m-file" placeholder="Ссылка на файл">
        <button class="btn" style="background: gold; color: black;" onclick="addModel()">Опубликовать</button>
    </div>

    <script>
        // --- НАСТРОЙКИ SUPABASE ---
        const SB_URL = "sb_publishable_8XxnJmUhi7o2yCbT6Eho-w_fnxvj7-h"; 
        const SB_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InJnbGxpbWdvem5hcGtpY3lucXh2Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3Njg3NDI1NzUsImV4cCI6MjA4NDMxODU3NX0.pLxA4QcEJfiIL4PbGvJQe8toFZOn0-OmC-6q0zCQ5O0";
        const supabase = supabase.createClient(SB_URL, SB_KEY);

        // --- ЛОГИКА ВХОДА ---
        async function handleAuth() {
            const email = document.getElementById('email').value;
            const password = document.getElementById('password').value;

            // Пробуем войти
            let { data, error } = await supabase.auth.signInWithPassword({ email, password });

            // Если не вышло войти, пробуем зарегистрировать
            if (error) {
                const { data: regData, error: regError } = await supabase.auth.signUp({ email, password });
                if (regError) return alert("Ошибка: " + regError.message);
                alert("Регистрация успешна! Теперь войдите.");
            } else {
                initSite(data.user);
            }
        }

        function initSite(user) {
            document.getElementById('auth-screen').style.display = 'none';
            document.getElementById('main-site').style.display = 'block';

            // ПРОВЕРКА НА АДМИНА (Замени на свой email или ID)
            // В Supabase первый юзер обычно имеет доступ к админке в нашем коде
            if (user.email === "admin@example.com" || user.id) { 
                // Для теста показываем всем, кто вошел, но в будущем тут будет проверка ID
                document.getElementById('admin-btn').style.display = 'block';
            }
            loadNews();
        }

        // --- РАБОТА С МОДЕЛЯМИ ---
        async function loadModels() {
            const { data: models } = await supabase.from('models').select('*');
            let html = '<h1>Все модели</h1><div class="grid">';
            models.forEach(m => {
                html += `
                    <div class="card" onclick="openModelPage(${m.id})">
                        <img src="${m.image_url}" onerror="this.src='https://via.placeholder.com/250x150'">
                        <h3>${m.name}</h3>
                        <p style="color: #888; font-size: 12px;">${m.description.substring(0, 50)}...</p>
                    </div>
                `;
            });
            document.getElementById('page-content').innerHTML = html + '</div>';
        }

        async function openModelPage(id) {
            const { data: m } = await supabase.from('models').select('*').eq('id', id).single();
            document.getElementById('page-content').innerHTML = `
                <button class="btn" style="width: 100px; margin-bottom: 20px;" onclick="loadModels()">← Назад</button>
                <div style="display: flex; gap: 40px;">
                    <img src="${m.image_url}" style="width: 400px; border-radius: 10px;">
                    <div>
                        <h1>${m.name}</h1>
                        <p style="margin: 20px 0; line-height: 1.6; color: #ccc;">${m.description}</p>
                        <a href="${m.file_url}" target="_blank" class="btn" style="display: inline-block; text-decoration: none; text-align: center;">СКАЧАТЬ МОДЕЛЬ</a>
                    </div>
                </div>
            `;
        }

        // --- ФУНКЦИИ АДМИНА ---
        function toggleAdminModal(show) {
            document.getElementById('admin-modal').style.display = show ? 'block' : 'none';
            document.getElementById('overlay').style.display = show ? 'block' : 'none';
        }

        async function addModel() {
            const name = document.getElementById('m-name').value;
            const desc = document.getElementById('m-desc').value;
            const img = document.getElementById('m-img').value;
            const file = document.getElementById('m-file').value;

            const { error } = await supabase.from('models').insert([{ name, description: desc, image_url: img, file_url: file }]);
            if (error) alert(error.message);
            else {
                alert("Модель добавлена!");
                toggleAdminModal(false);
                loadModels();
            }
        }

        async function loadNews() {
            const { data: news } = await supabase.from('news').select('*').order('created_at', { ascending: false });
            let html = '<h1>Новости проекта</h1>';
            news.forEach(n => {
                html += `
                    <div style="background: #1e1e23; padding: 20px; border-radius: 10px; margin-bottom: 20px; border-left: 4px solid #ff3333;">
                        <h3>${n.title}</h3>
                        <p style="color: #aaa; margin-top: 10px;">${n.content}</p>
                    </div>
                `;
            });
            document.getElementById('page-content').innerHTML = html || "<h1>Новостей пока нет</h1>";
        }
    </script>
</body>
</html>
